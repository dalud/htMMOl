<html>

<body onkeypress="userInput(event)"
	style="background-color:black;">
	<table id="UI">
		<tr id="plaeyrStats"><td id=HP style="color: red"></td></tr>
		<tr><td><table id=mapTable style="color: white"></table></td></tr>
		<tr><td id=statusDiv style="color: white"></td></tr>
	</table>
</body>

<script>
	var map = document.getElementById('mapTable');
	var statusW = document.getElementById('statusDiv');
	var HPDisplay = document.getElementById('HP');
	var viewPortWidth = 16*3;
	var viewPortHeight = 8*3;
    var playerXY = {x:viewPortWidth/2, y:viewPortHeight/2};
	var terrainY = new Array(viewPortHeight);
	var activeTile = {x:playerXY.x, y:playerXY.y};
	var playerHP = 12;

    map.addEventListener('mouseleave', function () {
        statusW.innerHTML = "";
    });
    map.addEventListener('click', function () {
        action(activeTile.x, activeTile.y);
    });
	//Build Arrays to hold terrain info
	for(j=0; j<terrainY.length; j++) {
    	var terrainX = new Array(viewPortWidth);
    	for(i=0; i<viewPortWidth; i++){
    	    terrainX[i] = "";
		}
		terrainY[j] = terrainX;
	}

    //Build PlayerStats
    function updatePlayerStats(){
        HPDisplay.innerHTML = "HP: " +playerHP;
    }
    updatePlayerStats();


	//Build Viewport
	for(j=0; j<viewPortHeight; j++){
		map.insertRow(j);
		for(i=0; i<viewPortWidth; i++) {
			map.rows[j].insertCell(i);
			map.rows[j].cells[i].addEventListener('mouseover', function () {
				getInfo(this);
			});
		}
	}

	function userInput(event){
		var k = event.which || event.keyCode;

		if(k==119 || k==97 || k==115 || k==100) move(k); //W, A, S, D
		//else alert(k);
	}

	function move(k){
        if(k == 119) --playerXY.y;
		else if(k == 97) --playerXY.x;
		else if(k == 115) ++playerXY.y;
		else if(k == 100) ++playerXY.x;

		//restrict to visible area
		if(playerXY.x == viewPortWidth) playerXY.x = viewPortWidth-1;
		if(playerXY.x < 0) playerXY.x = 0;
		if(playerXY.y == viewPortHeight) playerXY.y = viewPortHeight-1;
		if(playerXY.y < 0) playerXY.y = 0;

		draw();
	}

	function draw(){
		for(j=0; j<viewPortHeight; j++){
			for(i=0; i<viewPortWidth; i++){
        	    if(playerXY.x == i && playerXY.y == j) {
                    map.rows[j].cells[i].style = "color:BurlyWood; cursor:default";
                    map.rows[j].cells[i].innerHTML = "Q";
                    terrainY[j][i] = " You!";
				}
				else {
                    map.rows[j].cells[i].style = "color:green; cursor:default";
                    map.rows[j].cells[i].innerHTML = "#";
                    terrainY[j][i] = " a patch of grass.";
				}
			}
		}
	}

	function getInfo(tile) {
	    activeTile.x = tile.cellIndex;
	    activeTile.y = tile.parentNode.rowIndex;
		var terrain = terrainY[tile.parentNode.rowIndex][tile.cellIndex];
	    statusW.innerHTML = "That is " +terrain;
	}

	function action(x, y){
	    statusW.innerHTML = "You attack " +terrainY[y][x];
	    playerHP--;
	    updatePlayerStats();
	}

	draw();
</script>
</html>